# Custom Fonts for STM32G431CBU6 Project

This document describes the custom monospace fonts generated for the STM32G431CBU6 PD-Sink project.

## Generated Fonts

### 1. Digital Font (24Ã—48 pixels)
- **Purpose**: Large numeric display for voltage, current, power readings
- **Characters**: `0123456789-.` (12 characters total)
- **Dimensions**: 24Ã—48 pixels per character
- **Type**: Monospace (all characters same width)
- **Flash Address**: `0x7D0000` (8,192,000)
- **File Size**: 1,852 bytes
- **File**: `digit_font_24x48.bin`

### 2. ASCII Font (16Ã—24 pixels)
- **Purpose**: General text display for menus, labels, status messages
- **Characters**: ASCII 32-126 (95 printable characters)
- **Dimensions**: 16Ã—24 pixels per character
- **Type**: Monospace (all characters same width)
- **Flash Address**: `0x7D1000` (8,196,096)
- **File Size**: 5,514 bytes
- **File**: `ascii_font_16x24.bin`

## Font Data Format

Both fonts use the same binary format compatible with the existing font system:

```
[4 bytes] Character count (little-endian)
[NÃ—10 bytes] Character information array:
  - [4 bytes] Unicode code point (little-endian)
  - [1 byte] Character width
  - [1 byte] Character height
  - [4 bytes] Bitmap data offset (little-endian)
[Variable] Bitmap data (1 bit per pixel, packed by bytes)
```

## Flash Memory Layout

```
Address Range    | Size  | Content
-----------------|-------|----------------------------------
0x7D0000-0x7D0FFF| 4KB   | 24Ã—48 Digital Font
0x7D1000-0x7D2FFF| 8KB   | 16Ã—24 ASCII Font
0x7D3000-0xFFFFFF| ~8.5MB| Reserved for future use
```

## Usage in STM32 Code

### Font Base Addresses
```rust
const DIGIT_FONT_24X48_BASE: u32 = 0x7D0000;
const ASCII_FONT_16X24_BASE: u32 = 0x7D1000;
```

### Character Lookup
Characters are sorted by Unicode value for efficient binary search:
- Digital font: `-` (0x002D), `.` (0x002E), `0`-`9` (0x0030-0x0039)
- ASCII font: ` ` (0x0020) through `~` (0x007E)

## Tools and Scripts

### Generation Tools
- `tools/custom_font_generator.py` - Standalone font generator
- `tools/font_converter.py` - Extended to include custom fonts
- `tools/font_viewer.py` - Font file inspector and validator

### Verification Tools
- `tools/verify_fonts_in_flash.py` - Verify fonts in final flash image

### Usage Examples
```bash
# Generate custom fonts only
python tools/custom_font_generator.py --output-dir output

# Generate all fonts (including custom)
python tools/font_converter.py

# View font information
python tools/font_viewer.py output/digit_font_24x48.bin --info

# Render character as ASCII art
python tools/font_viewer.py output/digit_font_24x48.bin --render 5

# Verify fonts in flash image
python tools/verify_fonts_in_flash.py pd-sink-128mbit.bin
```

## Integration Status

âœ… **Completed:**
- Custom font generation tools
- Integration with existing build system
- Flash memory layout updated
- Font data verification
- Final binary generation (`pd-sink-128mbit.bin`)

ðŸ”„ **Next Steps (Optional):**
- Create STM32 font renderer classes
- Add font rendering test code
- Performance optimization

## Font Quality

The fonts are generated using high-quality system fonts (Courier New) and rendered at appropriate sizes to ensure clarity at the target pixel densities:
- 24Ã—48 font uses 36pt source for crisp large digits
- 16Ã—24 font uses 18pt source for readable small text

Both fonts maintain excellent readability on embedded displays while being optimized for minimal flash usage.

## File Locations

```
flash-programmer-reference/examples/flash-content-generator/
â”œâ”€â”€ pd-sink-128mbit.bin              # Final flash image (16MB)
â”œâ”€â”€ assets/font_output/
â”‚   â”œâ”€â”€ digit_font_24x48.bin         # 24Ã—48 digit font
â”‚   â””â”€â”€ ascii_font_16x24.bin         # 16Ã—24 ASCII font
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ custom_font_generator.py     # Font generation tool
â”‚   â”œâ”€â”€ font_viewer.py               # Font inspection tool
â”‚   â””â”€â”€ verify_fonts_in_flash.py     # Flash verification tool
â””â”€â”€ assets/resource_layout.json      # Updated memory layout
```

---
*Generated by AI Assistant (ç™½ç¾½) - 2025-01-20*
